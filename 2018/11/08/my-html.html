<!DOCTYPE html>

<html>

  <head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/demo/img/favicon.ico"/>
  <title>
    테스트 업로드 파일입니다. - 시불막창
    
  </title>

  <meta name="description" content="오늘 저녁은 족발을 먹고 싶네요 필동족발 선지국이 맛있을 거 같은데">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/demo/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/demo/assets/vendor/font-awesome/css/font-awesome.min.css">

  <link rel="stylesheet" href="/demo/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/demo/2018/11/08/my-html.html">
  <link rel="alternate" type="application/rss+xml" title="시불막창" href="/demo/feed.xml">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>

  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
</head>


  <body>

    <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/demo/">시불막창</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/demo/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/demo/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/demo/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/demo/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


    <!-- Page Header -->

<header class="masthead" style="background-image: url('/demo/img/posts/06.jpg')">



  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <div class="post-heading">
          <h1>테스트 업로드 파일입니다.</h1>
          
          <h2 class="subheading">잘 되어야 할 텐데 말이죠...</h2>
          
          <span class="meta">Posted by
            <a href="#">시불막창</a>
            on November 08, 2018</span>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">

      <p> 오늘 저녁은 족발을 먹고 싶네요 </p>
<p> 필동족발 선지국이 맛있을 거 같은데 </p>

      <hr>

      <body>
<meta charset="utf-8">

<link rel="stylesheet" href="/demo/assets/vendor/comments/style.css">
<input type="hidden" id="post_title" name="post_title" value="테스트_업로드_파일입니다."/>
<input type="hidden" id="post_date" name="post_date" value="2018-11-08 16:34:13 -0900"/>

<script type="text/javascript">
  var post_title = document.getElementById('post_title').value;
  var post_date = document.getElementById('post_date').value;
  var post_id = post_title.substring(0,10) +'/'+ post_date.substring(0,10);
</script>

  <div>
      <!-- <input type="hidden" id="UserID" name="UserID" /> -->
      <textarea rows="5" id="_text" name="_text"></textarea>
  </div>
  <div>
    <div class="wrapper2">
      <!-- <div> </div> -->
      <div> <input class="IDPW" name="UserName" id="UserName" placeholder="Name" ></input> </div>
      <div> <input class="IDPW" type="password" name="pw" id="pw" placeholder="PW"></input> </div>
      <div> </div>
      <div> <input class='btn' type='submit' value='작성' onclick="return AddComment();"></input></div>
    </div>
      <div class="comment" id="commentForm">
          <div id="Progress_Loading">
            <img style="position:absolute; left:50%;" src="/demo/assets/vendor/comments/progress_loading.gif"/>
          </div>
          <div class='show'>

          </div>
      </div>
  </div>

<script type="myTemplate" id="listTemplate">
  
  {{#if push_flag}}
  
  <details>
    <summary>정치 혐오 댓글이 감지되었습니다.</summary>
    <div class="clearfix">
      <div class="wrapper">
        <div style="text-align:center"> <img src="/demo/assets/vendor/comments/userimage.png" height="48" width="48"> </div>
        
          <div>
            <div id="commentform{{cmt_id}}" name="commentform{{cmt_id}}">
            <div class="comment-form" id="comment_text" name="comment_text"> {{cmt_content}} </div>
          </div>
          <div style="display:none;" id="editform{{cmt_id}}" name="editform{{cmt_id}}">
            <textarea id="edit_text{{cmt_id}}" name="edit_text{{cmt_id}}" rows="5">{{cmt_content}}</textarea>
          </div>
        </div>
        <div>
          <label style="float:right;">{{cmt_date}}</label>
          <label style="float:right;">{{cmt_time}}</label> </div>
          <div style="text-align:center">{{cmt_name}}</div>
          <div> <input class="IDPW" style="float:right;" type="password" name="Inputpw{{cmt_id}}" id="Inputpw{{cmt_id}}" placeholder="PW" type="password"></input>
            <input name="Userpw{{cmt_id}}" id="Userpw{{cmt_id}}" type="hidden" value="{{user_pw}}"></input></div>
          <div class="button-group">

            
            <button  class="editbtn" type="button" id="editbtn{{cmt_id}}" name="editbtn{{cmt_id}}" onclick="ShowEditForm({{cmt_id}});">
             <img src="/demo/assets/vendor/comments/edit.png" height="20" width="20">
            </button>
            <button  class="delbtn" type="button" id="delbtn{{cmt_id}}" name="delbtn{{cmt_id}}" onclick="CheckDelete({{cmt_id}});" >
              <img src="/demo/assets/vendor/comments/del.png" height="20" width="20" />
            </button>

            <button  class="editbtn_submit" type="button" id="edit_postbtn{{cmt_id}}" name="edit_postbtn{{cmt_id}}" style="display:none;" onclick="EditSubmit({{cmt_id}})" >
             <img src="/demo/assets/vendor/comments/check-mark.png" height="20" width="20">
            </button>

            <button class="cancelbtn" type="button" id="cancelbtn{{cmt_id}}" name="cancelbtn{{cmt_id}}" onclick="EditCancelForm({{cmt_id}});" style="display:none;" >
            <img src="/demo/assets/vendor/comments/cancel.png" height="20" width="20">
            </button>

        </div>
      </div>
    </div>

  </details>
    <hr>
    
      {{else}}
    

      <div class="clearfix">
        <div class="wrapper">
          <div style="text-align:center"> <img src="/demo/assets/vendor/comments/userimage.png" height="48" width="48"> </div>
          
            <div>
              <div id="commentform{{cmt_id}}" name="commentform{{cmt_id}}">
              <div class="comment-form" id="comment_text" name="comment_text"> {{cmt_content}} </div>
            </div>
            <div style="display:none;" id="editform{{cmt_id}}" name="editform{{cmt_id}}">
              <textarea id="edit_text{{cmt_id}}" name="edit_text{{cmt_id}}" rows="5">{{cmt_content}}</textarea>
            </div>
          </div>
          <div>
            <label style="float:right;">{{cmt_date}}</label>
            <label style="float:right;">{{cmt_time}}</label> </div>
            <div style="text-align:center">{{cmt_name}}</div>
            <div> <input class="IDPW" style="float:right;" type="password" name="Inputpw{{cmt_id}}" id="Inputpw{{cmt_id}}" placeholder="PW"></input>
              <input name="Userpw{{cmt_id}}" id="Userpw{{cmt_id}}" type="hidden" value="{{user_pw}}"></input></div>
            <div class="button-group">

              
              <button  class="editbtn" type="button" id="editbtn{{cmt_id}}" name="editbtn{{cmt_id}}" onclick="ShowEditForm({{cmt_id}});">
               <img src="/demo/assets/vendor/comments/edit.png" height="20" width="20">
              </button>
              <button  class="delbtn" type="button" id="delbtn{{cmt_id}}" name="delbtn{{cmt_id}}" onclick="CheckDelete({{cmt_id}});" >
                <img src="/demo/assets/vendor/comments/del.png" height="20" width="20" />
              </button>

              <button  class="editbtn_submit" type="button" id="edit_postbtn{{cmt_id}}" name="edit_postbtn{{cmt_id}}" style="display:none;" onclick="EditSubmit({{cmt_id}})" >
               <img src="/demo/assets/vendor/comments/check-mark.png" height="20" width="20">
              </button>

              <button class="cancelbtn" type="button" id="cancelbtn{{cmt_id}}" name="cancelbtn{{cmt_id}}" onclick="EditCancelForm({{cmt_id}});" style="display:none;" >
              <img src="/demo/assets/vendor/comments/cancel.png" height="20" width="20">
              </button>

          </div>
        </div>
      </div>
    <hr>
    
    {{/if}}
    
</script>

<script type="text/javascript">
async function AddComment(){
  var _comment = document.getElementById("_text").value;
  var userName =  document.getElementById("UserName").value.trim();
  var userPw =  document.getElementById("pw").value.trim();
  // 네아로 추가시 아래 활성화
  // if(!name || userID===""){
  //     alert("로그인 필수");
  //     return false;
  // }
  if(!userName || !userPw){
    alert("이름 & 비밀번호 입력 필수 !!");
    return false;
  }
  if(_comment ==""){
    alert("내용입력 필수 !!");
    return false;
  }
  var _postId = await getPostId();
  var commentData = {comment_text: _comment, user_id:userName, user_pw :userPw , post_id:post_id}
  console.log(commentData)
  $(document).ready(function() {
      $.ajax({
          type:"GET",
          url:"https://externship.livere.com/comment/add",
          dataType:"JSON",
          data: commentData,
          success:function(result){
            console.log('Add Comment success..'+result);
            alert('댓글을 등록하였습니다.')
            showComment();
          },
          error: function(xhr,status,error){
            console.log('ajax 통신 에러 - 댓글 추가 실패',error)
            showComment();
          }
        });
      window.location.reload(true);
    });
}
function CheckDelete(cmt_id){
  var _Inputpw =  document.getElementById("Inputpw"+cmt_id).value;
  var _Userpw =  document.getElementById("Userpw"+cmt_id).value;
  if(_Userpw != _Inputpw){
    alert("비밀번호가 틀렸습니다.");
    return;
  }else{
    var check ="삭제하시겠습니까?";
    console.log(check)
    // 본인 댓글인지 확인 절차 필요
    if(confirm(check)===true){
        $.ajax({
          type:"GET",
          url:"https://externship.livere.com/comment/del",
          data:{comment_id:cmt_id},
          dataType: "JSON",
          succes:function(result){
            console.log("삭제 처리 완료-"+result)
            alert('댓글을 삭제하였습니다.')
          },
          error:function(xhr,status,error){
            console.log("삭제 처리 실패-"+error)
          }
        });
        window.location.reload(true);
    }
  }
}
function ShowEditForm(ID) {
  var _Inputpw =  document.getElementById("Inputpw"+ID).value;
  var _Userpw =  document.getElementById("Userpw"+ID).value;

  if(_Userpw != _Inputpw){
    alert("비밀번호가 틀렸습니다.");
    document.getElementById("Inputpw"+ID).value="";
    return;
  }else{
    document.getElementById("commentform"+ID).style.display = "none";
    document.getElementById("editform"+ID).style.display = "";
    document.getElementById("editbtn"+ID).style.display = "none";
    document.getElementById("delbtn"+ID).style.display = "none";
    document.getElementById("edit_postbtn"+ID).style.display = "";
    document.getElementById("cancelbtn"+ID).style.display = "";
    document.getElementById("Inputpw"+ID).style.display="none";
    document.getElementById("Inputpw"+ID).value="";
    getPostId();
    return;
  }
}
function EditComment(ID) {
  var check="수정 ?";
  var edittext =document.getElementById("edit_text"+ID).value;
  if (confirm(check)) {
      document.getElementById("edit_content").value = edittext;
      edit_content=edittext;
      return true;
  }else{
      return false;
  }
}
function EditCancelForm(ID) {
  var check="수정 취소 ?";
  if(confirm(check)){
      // window.location.reload(true);
      document.getElementById("commentform"+ID).style.display = "";
      document.getElementById("editform"+ID).style.display = "none";
      document.getElementById("editbtn"+ID).style.display = "";
      document.getElementById("delbtn"+ID).style.display = "";
      document.getElementById("edit_postbtn"+ID).style.display = "none";
      document.getElementById("cancelbtn"+ID).style.display = "none";
      document.getElementById("Inputpw"+ID).style.display="";
      return;
  }else{
      return ;
  }
}
function EditSubmit(ID){
  if(confirm("수정하시겠습니까?")){
    var new_comment=document.getElementById("edit_text"+ID).value;
    console.log(new_comment);
    $.ajax({
      type:"GET",
      url:"https://externship.livere.com/comment/edit",
      data:{comment_id: ID, comment_text:new_comment},
      success: function(result){
        console.log("수정 완료 - "+result);
        alert("댓글 수정 완료")
      },
      error: function(xhr,status,error){
        console.log("수정 오류 - "+error);
      }
    });
    window.location.reload(true);
  }
}
function getPostId(){
  return post_id;
}
</script>

<script>
  var data=[];
  console.log(getPostId())
  function showComment(){
    // Handlebars.registerHelper('ifCond',function(flag){
    //   if(flag==1) return options.fn(this);
    //   else return options.inverse(this);
    // });
    var template = document.querySelector("#listTemplate").innerText;
    var bindTemplate = Handlebars.compile(template);
    console.log('loading comments...')
    $(document).ready(function() {
      $.ajax({
        type:"GET",
        url: "https://externship.livere.com/comment/get",
        data: {post_id:getPostId()},
        dataType:"JSON",
        beforeSend:function(){
          $('#Progress_Loading').show(); //ajax실행시 로딩바를 보여준다.
        },
        success:function(result){
          $('#Progress_Loading').hide(); //ajax종료시 로딩바를 숨겨준다.
          data =result['results'];
          console.log(data);
          var resultHTML = data.reduce(function(prev,next) {
            return prev + bindTemplate(next);
          },"");
          var show = document.querySelector(".show");
          show.innerHTML += resultHTML;
        },
        error: function(xhr,status,error){
          console.log('ajax 통신 에러',error)
        }
      })
    });
  }
showComment();
</script>
</body>


      <div class="clearfix">

        
        
        <a class="btn btn-primary float-right" href="/demo/2018/11/09/post2.html" data-toggle="tooltip" data-placement="top" title="오늘은 양고기를 먹었스빈다.">Next<span class="d-none d-md-inline"> Post</span> &rarr;</a>
        

      </div>

    </div>
    <!-- <div  class="col-lg-8 col-md-10 mx-auto">

    </div> -->

  </div>
</div>


    <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/jaehyunonline">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; 시불막창 2018</p>
      </div>
    </div>
  </div>
</footer>


    <script src="/demo/assets/vendor/jquery/jquery.min.js"></script>
<script src="/demo/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/demo/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/demo/assets/scripts.js"></script>




  </body>

</html>
